const e="Higress-gvr7dx_awbbpb_fi4t7317cvughlzh.mdx",s="blog",a="higress-gvr7dx_awbbpb_fi4t7317cvughlzh",o=`
\u4F5C\u8005\u4ECB\u7ECD\uFF1B\u6F84\u6F6D\u3001\u5982\u8451
<a name="CXVYK"></a>
## \u524D\u8A00

\u672C\u6587\u4E2D Demo \u8FD0\u884C\u7684\u524D\u63D0\uFF0C\u9700\u8981\u5728 K8s \u96C6\u7FA4\u4E2D\u5B89\u88C5\u4E86 Higress\uFF0C\u5E76\u751F\u6548\u4E86\u4E0B\u9762\u8FD9\u4EFD quickstart \u914D\u7F6E\uFF1A<br />https://github.com/alibaba/higress/releases/download/v0.5.2/quickstart.yaml<br />\u8FD9\u4E2A Demo \u8981\u5B9E\u73B0\u7684\u529F\u80FD\u662F\u4E00\u4E2A Mock \u5E94\u7B54\u7684\u529F\u80FD\uFF0C\u9700\u8981\u5B9E\u73B0\u6839\u636E\u914D\u7F6E\u7684\u5185\u5BB9\uFF0C\u8FD4\u56DE HTTP \u5E94\u7B54\u3002<br />\u672C\u6587\u4F1A\u6309\u4EE5\u4E0B\u65B9\u5F0F\u8FDB\u884C\u4ECB\u7ECD\uFF1A

- \u7F16\u5199\u4EE3\u7801\uFF1A\u4EE3\u7801\u903B\u8F91\u89E3\u6790
- \u751F\u6548\u63D2\u4EF6\uFF1A\u8BF4\u660E\u4EE3\u7801\u5982\u4F55\u8FDB\u884C\u7F16\u8BD1\u6253\u5305\u5E76\u90E8\u7F72\u751F\u6548
- \u6D4B\u8BD5\u63D2\u4EF6\u529F\u80FD\uFF1A\u8BF4\u660E\u5168\u5C40\u7C92\u5EA6\uFF0C\u8DEF\u7531/\u57DF\u540D\u7EA7\u7C92\u5EA6\u5982\u4F55\u751F\u6548
- \u63D2\u4EF6\u751F\u6548\u539F\u7406\uFF1A\u5BF9\u6574\u4F53\u6D41\u7A0B\u8FDB\u884C\u56DE\u987E\uFF0C\u8BF4\u660E\u63D2\u4EF6\u751F\u6548\u7684\u539F\u7406
- \u4E09\u4E2A\u9769\u547D\u6027\u7684\u7279\u6027\uFF1A\u4ECB\u7ECD Wasm \u63D2\u4EF6\u673A\u5236\u4E3A\u7F51\u5173\u63D2\u4EF6\u5F00\u53D1\u5E26\u6765\u7684\u53D8\u9769 
<a name="H1YZi"></a>
## \u7F16\u5199\u4EE3\u7801 
\`\`\`
package main
import (    . "github.com/alibaba/higress/plugins/wasm-go/pkg/wrapper"    "github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm"    "github.com/tetratelabs/proxy-wasm-go-sdk/proxywasm/types"    "github.com/tidwall/gjson")
func main() {    SetCtx(        "my-plugin",        ParseConfigBy(parseConfig),        ProcessRequestHeadersBy(onHttpRequestHeaders),    )}
type MyConfig struct {    content string}
func parseConfig(json gjson.Result, config *MyConfig, log Log) error {    config.content = json.Get("content").String()    return nil}
func onHttpRequestHeaders(ctx HttpContext, config MyConfig, log Log) types.Action {    proxywasm.SendHttpResponse(200, nil, []byte(config.content), -1)    return types.ActionContinue}
\`\`\`
\u4E0A\u9762\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u5230\u4E09\u4E2A\u51FD\u6570\uFF1A

- main\uFF1A\u63D2\u4EF6\u901A\u8FC7 main \u51FD\u6570\u5B9A\u4E49\u63D2\u4EF6\u4E0A\u4E0B\u6587\uFF0C\u5305\u62EC\u63D2\u4EF6\u540D\u79F0\uFF0C\u7528\u4E8E\u89E3\u6790\u914D\u7F6E\u7684\u51FD\u6570\uFF0C\u4EE5\u53CA\u7528\u4E8E\u5904\u7406\u8BF7\u6C42/\u5E94\u7B54\u7684\u51FD\u6570 
- parseConfig\uFF1A\u8FD9\u4E2A\u51FD\u6570\u901A\u8FC7\u5728 SetCtx \u4E2D\u6307\u5B9A\u7684 ParseConfigBy \u88AB\u6302\u8F7D\u5230\u63D2\u4EF6\u914D\u7F6E\u89E3\u6790\u9636\u6BB5\uFF0C\u4F20\u5165\u7684\u4E09\u4E2A\u53C2\u6570\u5206\u522B\u662F\uFF1A
   - json\uFF1A\u4F20\u5165\u63D2\u4EF6\u7684\u914D\u7F6E\uFF0C\u5C06\u7EDF\u4E00\u5E8F\u5217\u5316\u4E3A\u4E00\u4E2A json \u5B57\u5178\u5BF9\u8C61\uFF0C\u63D0\u4F9B parseConfig \u8FDB\u884C\u89E3\u6790
   - config\uFF1AparseConfig \u5C06\u89E3\u6790\u540E\u7684\u63D2\u4EF6\u914D\u7F6E\u8F93\u51FA\u5230\u8FD9\u4E2A MyConfig \u5BF9\u8C61
   - log\uFF1A\u63D0\u4F9B\u65E5\u5FD7\u8F93\u51FA\u63A5\u53E3 
- onHttpRequestHeaders\uFF1A\u51FD\u6570\u4E2D\u8C03\u7528\u7684 proxywasm.SendHttpResponse\uFF0C\u7528\u4E8E\u5B9E\u73B0\u76F4\u63A5\u8FD4\u56DE HTTP \u5E94\u7B54\uFF0C\u8FD9\u4E2A\u51FD\u6570\u901A\u8FC7\u5728 SetCtx \u4E2D\u6307\u5B9A\u7684 ProcessRequestHeadersBy \u88AB\u6302\u8F7D\u5230\u89E3\u6790\u8BF7\u6C42 Header \u7684\u6267\u884C\u9636\u6BB5\uFF0C\u5176\u4ED6\u7684\u6302\u8F7D\u65B9\u5F0F\u8FD8\u6709\uFF1A
   - ProcessRequestBodyBy\uFF1A\u6302\u8F7D\u5230\u89E3\u6790\u8BF7\u6C42 Body \u7684\u6267\u884C\u9636\u6BB5
   - ProcessResponseHeadersBy\uFF1A\u6302\u8F7D\u5230\u6784\u9020\u5E94\u7B54 Header \u7684\u6267\u884C\u9636\u6BB5
   - ProcessResponseBodyBy\uFF1A\u6302\u8F7D\u5230\u6784\u9020\u5E94\u7B54 Body \u7684\u6267\u884C\u9636\u6BB5 

     \u4F20\u5165\u7684\u4E09\u4E2A\u53C2\u6570\u5206\u522B\u662F\uFF1A

   - ctx\uFF1A\u7528\u4E8E\u83B7\u53D6\u8BF7\u6C42\u4E0A\u4E0B\u6587\uFF0C\u5982 scheme/method/path \u7B49\uFF0C\u901A\u8FC7 ctx \u53EF\u4EE5\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u4E0A\u4E0B\u6587\uFF0C\u80FD\u8DE8\u6267\u884C\u9636\u6BB5\u8BBF\u95EE
   - config\uFF1A\u63D0\u4F9B parseConfig \u89E3\u6790\u597D\u7684\u81EA\u5B9A\u4E49\u914D\u7F6E
   - log\uFF1A\u63D0\u4F9B\u65E5\u5FD7\u8F93\u51FA\u63A5\u53E3 

\u8FD9\u4E2A 30 \u884C\u4EE3\u7801\u5B9E\u73B0\u7684\u63D2\u4EF6\u529F\u80FD\u6BD4\u8F83\u7B80\u5355\uFF0C\u8FD9\u91CC\u6709\u4E00\u4E9B\u529F\u80FD\u76F8\u5BF9\u590D\u6742\u7684\u4F8B\u5B50\uFF1A<br />https://github.com/alibaba/higress/tree/main/plugins/wasm-go/extensions<br />\u8FD9\u91CC\u6709\u63D2\u4EF6 sdk \u7684\u8BE6\u7EC6\u4F7F\u7528\u6587\u6863\uFF1A<br />https://higress.io/zh-cn/docs/user/wasm-go.html<br />\u8FD9\u4E2A\u63D2\u4EF6 sdk \u662F\u57FA\u4E8E Tetrate \u793E\u533A\u7684 proxy-wasm-go-sdk \u5B9E\u73B0\u7684\uFF0C\u5982\u679C\u5173\u6CE8\u66F4\u5E95\u5C42\u7684\u7EC6\u8282\uFF0C\u53EF\u4EE5\u67E5\u770B\uFF1A<br />https://github.com/tetratelabs/proxy-wasm-go-sdk<br />https://github.com/alibaba/higress/blob/main/plugins/wasm-go/pkg/wrapper<br />\u53EF\u4EE5\u770B\u5230\uFF0CHigress \u7684 wasm-go sdk \u662F\u901A\u8FC7 Go 1.18 \u5F15\u5165\u7684\u6CDB\u578B\u7279\u6027\u5C01\u88C5\u4E86\u63D2\u4EF6\u4E0A\u4E0B\u6587\u5904\u7406\u7EC6\u8282\uFF0C\u4ECE\u800C\u964D\u4F4E\u63D2\u4EF6\u5F00\u53D1\u6240\u9700\u4EE3\u7801\u91CF\uFF0C\u5F00\u53D1\u8005\u53EA\u7528\u5173\u5FC3\u914D\u7F6E\u89E3\u6790\u548C\u8BF7\u6C42\u5E94\u7B54\u5904\u7406\u7684\u903B\u8F91\u3002
<a name="q0pYf"></a>
## \u751F\u6548\u63D2\u4EF6
\u7F16\u5199\u5B8C\u6210\u4EE3\u7801\u540E\uFF0C\u4E00\u5171\u6709\u4E09\u4E2A\u6B65\u9AA4\uFF0C\u5B9E\u73B0\u63D2\u4EF6\u903B\u8F91\u7684\u751F\u6548\uFF1A

1. \u7F16\u8BD1\uFF1A\u5C06 go \u4EE3\u7801\u7F16\u8BD1\u6210 Wasm \u683C\u5F0F\u6587\u4EF6
2. \u955C\u50CF\u63A8\u9001\uFF1A\u5C06 Wasm \u6587\u4EF6\u6253\u5305\u6210 docker \u955C\u50CF\uFF0C\u5E76\u63A8\u9001\u81F3\u955C\u50CF\u4ED3\u5E93
3. \u4E0B\u53D1\u914D\u7F6E\uFF1A\u5728 K8s \u4E0A\u521B\u5EFA WasmPlugin \u8D44\u6E90
<a name="j0mOz"></a>
### \u7F16\u8BD1
\u5C06\u4E0A\u9762\u7684 Go \u6587\u4EF6 main.go \u7F16\u8BD1\u6210 plugin.wasm

\`\`\`
tinygo build -o plugin.wasm -scheduler=none -target=wasi main.go
\`\`\`
<a name="86de94b2"></a>
### \u955C\u50CF\u63A8\u9001
\u7F16\u5199 Dockerfile

\`\`\`
FROM scratchCOPY plugin.wasm ./
\`\`\`
\u6784\u5EFA\u5E76\u63A8\u9001 Docker \u955C\u50CF \uFF08\u8FD9\u91CC\u793A\u4F8B\u7528\u7684\u662F Higress \u7684\u5B98\u65B9\u955C\u50CF\u4ED3\u5E93\uFF09
\`\`\`
docker build -t higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/demo:1.0.0 .docker push higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/demo:1.0.0
\`\`\`


<a name="e6baafbd"></a>
### \u4E0B\u53D1\u914D\u7F6E
\u7F16\u5199 wasmplugin.yaml\uFF0C\u914D\u7F6E\u8BF4\u660E\uFF1A

- selector\uFF1A\u9009\u4E2D\u4E86\u9ED8\u8BA4\u5B89\u88C5\u5728 higress-system \u547D\u540D\u7A7A\u95F4\u4E0B\u7684 higress-gateway \u751F\u6548\u8FD9\u4EFD\u63D2\u4EF6
- pluginConfig\uFF1A\u63D2\u4EF6\u914D\u7F6E\uFF0C\u6700\u7EC8\u4F1A\u88AB\u8F6C\u6362\u6210\u4E0A\u9762\u4EE3\u7801\u4E2D\u7684 MyConfig \u5BF9\u8C61
- url\uFF1A\u586B\u5199\u955C\u50CF\u5730\u5740\uFF0C\u9700\u8981\u4EE5"oci://"\u5F00\u5934 

\u9664\u4E86\u8FD9\u4E9B\u914D\u7F6E\u5916\uFF0C\u8FD8\u53EF\u4EE5\u5B9A\u4E49\u63D2\u4EF6\u7684\u6267\u884C\u9636\u6BB5\u548C\u4F18\u5148\u7EA7\u7B49\u8FDB\u9636\u914D\u7F6E\uFF0C\u53EF\u4EE5\u53C2\u8003 Istio API \u5B98\u65B9\u6587\u6863\uFF1A

https://istio.io/latest/docs/reference/config/proxy_extensions/wasm-plugin/
\`\`\`
# wasmplugin.yamlapiVersion: extensions.istio.io/v1alpha1kind: WasmPluginmetadata:  name: mock-response  namespace: higress-systemspec:  selector:    matchLabels:      higress: higress-system-higress-gateway  pluginConfig:    content: "hello higress"  url: oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/demo:1.0.0
\`\`\`
\u901A\u8FC7 kubectl \u521B\u5EFA\u8FD9\u4E2A\u8D44\u6E90
\`\`\`
kubectl apply -f wasmplugin.yaml
\`\`\`
<a name="HhNFv"></a>
## \u6D4B\u8BD5\u63D2\u4EF6\u529F\u80FD
\u57FA\u4E8E\u4E4B\u524D\u751F\u6548\u7684 quickstart.yaml\uFF0C\u76EE\u524D\u96C6\u7FA4\u4E2D\u7684 Ingress \u8BBF\u95EE\u62D3\u6251\u5982\u4E0B\u6240\u793A\uFF1A

<a name="Yw9qC"></a>
## ![](https://intranetproxy.alipay.com/skylark/lark/0/2024/webp/299576/1723449123388-840116a1-7373-422e-9d71-7f93b5a04ab6.webp#clientId=ubaf1ae1d-09cd-4&from=paste&id=uf1c9defa&originHeight=605&originWidth=646&originalType=url&ratio=1.7999999523162842&rotation=0&showTitle=false&status=done&style=none&taskId=u8b438616-519f-4238-8d01-b5ebb6fb6d3&title=)
\u672A\u751F\u6548\u63D2\u4EF6\u7684\u60C5\u51B5\u4E0B\uFF1A

- \u8BF7\u6C42/foo \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "foo"
- \u8BF7\u6C42/bar \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "bar" 
<a name="f6a53fb1"></a>
### \u5168\u5C40\u751F\u6548
\u57FA\u4E8E\u4E0A\u6587\u751F\u6548\u63D2\u4EF6\u9636\u6BB5\uFF0C\u4E0B\u53D1\u7684 wasmplugin.yaml\uFF0C\u751F\u6548\u63D2\u4EF6\u540E\u6548\u679C\u5982\u4E0B\uFF1A

- \u8BF7\u6C42/foo \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello higress"
- \u8BF7\u6C42/bar \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello higress"
<a name="f19d33f9"></a>
### \u57DF\u540D&\u8DEF\u7531\u7EA7\u751F\u6548
\u5C06 wasmplugin.yaml \u914D\u7F6E\u4FEE\u6539\u5982\u4E0B\uFF1A

\`\`\`
# wasmplugin.yamlapiVersion: extensions.istio.io/v1alpha1kind: WasmPluginmetadata:  name: mock-response  namespace: higress-systemspec:  selector:    matchLabels:      higress: higress-system-higress-gateway  pluginConfig:    content: "hello higress"    _rules_:    - content: "hello foo"      _match_route_:      - "default/foo"    - content: "hello bar"      _match_route_:      - "default/bar"    - content: "hello world"      _match_domain_:      - "*.example.com"      - "www.test.com"  url: oci://higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/demo:1.0.0
\`\`\`
\u5728 pluginConfig \u4E2D\u589E\u52A0\u4E86 _rules_  \u89C4\u5219\u5217\u8868\uFF0C\u89C4\u5219\u4E2D\u53EF\u4EE5\u6307\u5B9A\u5339\u914D\u65B9\u5F0F\uFF0C\u5E76\u586B\u5199\u5BF9\u5E94\u751F\u6548\u7684\u914D\u7F6E:

- _match_route_\uFF1A\u5339\u914D Ingress \u751F\u6548\uFF0C\u5339\u914D\u683C\u5F0F\u4E3A\uFF1AIngress \u6240\u5728\u547D\u540D\u7A7A\u95F4 + "/" + Ingress \u540D\u79F0
- _match_domain_\uFF1A\u5339\u914D\u57DF\u540D\u751F\u6548\uFF0C\u586B\u5199\u57DF\u540D\u5373\u53EF\uFF0C\u652F\u6301\u901A\u914D\u7B26 

\u751F\u6548\u8FD9\u4EFD\u4FEE\u6539\u540E\u7684\u914D\u7F6E\uFF1A
\`\`\`
kubectl apply -f wasmplugin.yaml
\`\`\`
\u53EF\u4EE5\u770B\u5230\u6548\u679C\u5982\u4E0B\uFF1A

- \u8BF7\u6C42/foo \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello foo" (\u5339\u914D\u5230\u7B2C\u4E00\u6761 rule)
- \u8BF7\u6C42/bar \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello bar" (\u5339\u914D\u5230\u7B2C\u4E8C\u6761 rule)
- \u8BF7\u6C42www.example.com \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello world" \uFF08\u5339\u914D\u5230\u7B2C\u4E09\u6761 rule\uFF09
- \u8BF7\u6C42www.abc.com \u5C06\u8FD4\u56DE HTTP \u5E94\u7B54 "hello higress" \uFF08\u6CA1\u6709\u5339\u914D\u7684 rule\uFF0C\u4F7F\u7528\u5168\u5C40\u914D\u7F6E\uFF09
<a name="O9xQz"></a>
## \u63D2\u4EF6\u751F\u6548\u539F\u7406
![](https://intranetproxy.alipay.com/skylark/lark/0/2024/webp/299576/1723449124380-9cfe7100-697d-496d-bc1e-159d62066179.webp#clientId=ubaf1ae1d-09cd-4&from=paste&id=uf1b058b1&originHeight=527&originWidth=1080&originalType=url&ratio=1.7999999523162842&rotation=0&showTitle=false&status=done&style=none&taskId=ufd39fdd7-d734-4f97-9237-40eaed5d913&title=)

\u8FD9\u91CC\u5BF9\u63D2\u4EF6\u7684\u751F\u6548\u673A\u5236\u7B80\u5355\u505A\u4E2A\u8BF4\u660E\uFF1A

1. \u7528\u6237\u5C06\u4EE3\u7801\u7F16\u8BD1\u6210 wasm \u6587\u4EF6
2. \u7528\u6237\u5C06 wasm \u6587\u4EF6\u6784\u5EFA\u6210 docker \u955C\u50CF
3. \u7528\u6237\u5C06 docker \u955C\u50CF\u63A8\u9001\u81F3\u955C\u50CF\u4ED3\u5E93
4. \u7528\u6237\u521B\u5EFA WasmPlugin \u8D44\u6E90
5. Istio watch \u5230 WasmPlugin \u8D44\u6E90\u7684\u53D8\u5316
6. Higress Gateway \u4E2D\u7684 xDS proxy \u8FDB\u7A0B\u4ECE Istio \u83B7\u53D6\u5230\u914D\u7F6E\uFF0C\u53D1\u73B0\u63D2\u4EF6\u7684\u955C\u50CF\u5730\u5740
7. xDS proxy \u4ECE\u955C\u50CF\u4ED3\u5E93\u62C9\u53D6\u955C\u50CF
8. xDS proxy \u4ECE\u955C\u50CF\u4E2D\u63D0\u53D6\u51FA wasm \u6587\u4EF6
9. Higress Gateway \u4E2D\u7684 envoy \u8FDB\u7A0B\u4ECE xDS proxy \u83B7\u53D6\u5230\u914D\u7F6E\uFF0C\u53D1\u73B0 wasm \u6587\u4EF6\u7684\u672C\u5730\u8DEF\u5F84
10. envoy \u4ECE\u672C\u5730\u6587\u4EF6\u4E2D\u52A0\u8F7D wasm \u6587\u4EF6 

\u8FD9\u91CC envoy \u83B7\u53D6\u914D\u7F6E\u5E76\u52A0\u8F7D wasm \u6587\u4EF6\u4F7F\u7528\u5230\u4E86 ECDS (Extension Config Discovery Service)\u7684\u673A\u5236\uFF0C\u5B9E\u73B0\u4E86 wasm \u6587\u4EF6\u66F4\u65B0\uFF0C\u76F4\u63A5\u70ED\u52A0\u8F7D\uFF0C\u4E0D\u4F1A\u5BFC\u81F4\u4EFB\u4F55\u8FDE\u63A5\u4E2D\u65AD\uFF0C\u4E1A\u52A1\u6D41\u91CF\u5B8C\u5168\u65E0\u635F\u3002<br />_**
<a name="Fxa1n"></a>
## \u4E09\u4E2A\u9769\u547D\u6027\u7684\u7279\u6027
\u4E0A\u9762\u7684 Wasm \u63D2\u4EF6\u673A\u5236\u4E3A\u7F51\u5173\u81EA\u5B9A\u4E49\u63D2\u4EF6\u5F00\u53D1\u5E26\u6765\u4E86\u4E09\u4E2A\u9769\u547D\u6027\u7684\u7279\u6027\u3002
<a name="d4c1a3e0"></a>
### \u7279\u6027\u4E00\uFF1A\u63D2\u4EF6\u751F\u547D\u5468\u671F\u548C\u7F51\u5173\u89E3\u8026
\u8FD9\u4E2A\u7279\u6027\u4E3B\u8981\u5F97\u76CA\u4E8E Istio \u7684 WasmPlugin \u673A\u5236\u8BBE\u8BA1\u3002\u53EF\u4EE5\u548C K8s Nginx Ingress \u7684\u63D2\u4EF6\u673A\u5236\u505A\u4E2A\u5BF9\u6BD4\uFF1A
<a name="installing-a-plugin"></a>
### Installing a plugin
There are two options:
\`\`\`
- mount your plugin into /etc/nginx/lua/plugins/<your plugin name> in the ingress-nginx pod
- build your own ingress-nginx image like it is done in the example and install your plugin during image build
\`\`\`
https://github.com/kubernetes/ingress-nginx/blob/main/rootfs/etc/nginx/lua/plugins/README.md<br />\u53EF\u4EE5\u770B\u5230 Nginx Ingress \u52A0\u8F7D\u81EA\u5B9A\u4E49\u63D2\u4EF6\uFF0C\u9700\u8981\u5C06 lua \u6587\u4EF6\u6302\u8F7D\u8FDB pod\uFF0C\u6216\u8005\u5728\u6784\u5EFA\u955C\u50CF\u65F6\u88C5\u5165\u3002\u8FD9\u6837\u5C31\u5C06\u63D2\u4EF6\u7684\u751F\u547D\u5468\u671F\u8DDF\u7F51\u5173\u7ED1\u5B9A\u5728\u4E00\u8D77\uFF0C\u63D2\u4EF6\u903B\u8F91\u66F4\u65B0\uFF0C\u9700\u8981\u53D1\u5E03\u65B0\u7248\u672C\uFF0C\u7F51\u5173\u4E5F\u9700\u8981\u53D1\u5E03\u65B0\u7248\u672C\u6216\u8005\u91CD\u65B0\u90E8\u7F72\u3002

\u4F7F\u7528 WasmPlugin \u7684\u673A\u5236\uFF0C\u63D2\u4EF6\u9700\u8981\u53D1\u5E03\u65B0\u7248\u672C\uFF0C\u53EA\u9700\u6784\u5EFA\u63D2\u4EF6\u81EA\u8EAB\u7684\u955C\u50CF\u5E76\u8FDB\u884C\u4E0B\u53D1\u751F\u6548\uFF0C\u800C\u4E14\u53EF\u4EE5\u57FA\u4E8E\u955C\u50CF\u7684 tag \u8FDB\u884C\u63D2\u4EF6\u7684\u7248\u672C\u7BA1\u7406\u3002\u8FD9\u6837\u63D2\u4EF6\u53D8\u66F4\uFF0C\u4E0D\u4EC5\u65E0\u9700\u91CD\u65B0\u90E8\u7F72\u7F51\u5173\uFF0C\u7ED3\u5408 Envoy \u7684 ECDS \u673A\u5236\u5BF9\u6D41\u91CF\u4E5F\u662F\u5B8C\u5168\u65E0\u635F\u3002
<a name="7d4f2a23"></a>
### \u7279\u6027\u4E8C\uFF1A\u9AD8\u6027\u80FD\u7684\u591A\u8BED\u8A00\u652F\u6301
\u57FA\u4E8E Wasm \u7684\u80FD\u529B\uFF0C\u53EF\u4EE5\u7528\u591A\u79CD\u8BED\u8A00\u7F16\u5199\u63D2\u4EF6\uFF0C\u5BF9\u5F00\u53D1\u4EBA\u5458\u66F4\u52A0\u53CB\u597D\u3002\u5B9E\u73B0\u591A\u8BED\u8A00\u5F00\u53D1\u63D2\u4EF6\u7684\u53E6\u4E00\u79CD\u65B9\u5F0F\u662F\u57FA\u4E8E RPC \u548C\u7F51\u5173\u8FDB\u7A0B\u901A\u4FE1\u7684\u5916\u7F6E\u8FDB\u7A0B/\u670D\u52A1\u63D2\u4EF6\uFF0C\u8FD9\u79CD\u6A21\u5F0F\u4F1A\u6709\u989D\u5916\u7684 IO \u5F00\u9500\uFF0C\u5E76\u4E14\u9644\u52A0\u7684\u8FDB\u7A0B/\u670D\u52A1\u4E5F\u5E26\u6765\u989D\u5916\u7684\u8FD0\u7EF4\u590D\u6742\u5EA6\u3002\u76EE\u524D\u5927\u5BB6\u5BF9 Wasm \u63D2\u4EF6\u7684\u6027\u80FD\u6BD4\u8F83\u5173\u5FC3\uFF0C\u4ECE\u6211\u4EEC\u7684\u6D4B\u8BD5\u6570\u636E\u6765\u770B\uFF0C\u6307\u4EE4\u6267\u884C\u6027\u80FD\u76F8\u6BD4\u539F\u751F\u7684 C++ \u8BED\u8A00\u786E\u5B9E\u6709\u5DEE\u8DDD\uFF0C\u4F46\u6027\u80FD\u548C Lua \u6301\u5E73\uFF0C\u4E14\u8FDC\u597D\u4E8E\u5916\u7F6E\u63D2\u4EF6\u3002

\u5BF9\u4E8E\u4E00\u6BB5\u903B\u8F91\uFF1A\u5FAA\u73AF\u6267\u884C 20 \u6B21\u8BF7\u6C42\u5934\u8BBE\u7F6E\uFF0C\u5FAA\u73AF\u6267\u884C 20 \u6B21\u8BF7\u6C42\u5934\u83B7\u53D6\uFF0C\u5FAA\u73AF\u6267\u884C 20 \u6B21\u8BF7\u6C42\u5934\u79FB\u9664\u3002\u6211\u4EEC\u5BF9\u6BD4\u4E86\u5206\u522B\u7528 Lua \u548C\u4E0D\u540C\u8BED\u8A00\u5B9E\u73B0\u7684 Wasm \u7684\u5904\u7406\u6027\u80FD\uFF0C\u4E0B\u9762\u662F\u5BF9\u5355\u4E2A\u8BF7\u6C42\u5EF6\u65F6\u7684\u5F71\u54CD\u5BF9\u6BD4\uFF1A

| \u5B9E\u73B0\u8BED\u8A00 | \u8BF7\u6C42\u5EF6\u65F6\u589E\u52A0 |
| --- | --- |
| Lua | 0.20\u6BEB\u79D2 |
| Wasm (C++) | 0.19\u6BEB\u79D2 |
| Wasm (Go) | 0.20\u6BEB\u79D2 |
| Wasm (Rust) | 0.21\u6BEB\u79D2 |
| Wasm (AssemblyScript) | 0.21\u6BEB\u79D2 |

<a name="483e31f9"></a>
### \u7279\u6027\u4E09\uFF1A\u5B89\u5168\u6C99\u7BB1
Envoy \u76EE\u524D\u652F\u6301\u591A\u79CD Wasm \u7684\u8FD0\u884C\u65F6\uFF0C\u4F8B\u5982 V8\uFF0CWAMR\uFF0Cwasmtime \u7B49\u7B49\uFF0C\u8FD9\u4E9B\u8FD0\u884C\u65F6\u5747\u63D0\u4F9B\u4E86\u5B89\u5168\u6C99\u7BB1\u80FD\u529B\uFF0C\u5373 Wasm \u63D2\u4EF6\u4E2D\u51FA\u73B0\u4E86\u8BBF\u95EE\u7A7A\u6307\u9488\u3001\u5F02\u5E38\u672A\u6355\u83B7\u7B49\u903B\u8F91\uFF0C\u4E5F\u4E0D\u4F1A\u4EE4 Envoy \u5BBF\u4E3B\u8FDB\u7A0B Crash\u3002\u5E76\u4E14\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E\uFF0C\u5728\u63D2\u4EF6\u903B\u8F91\u51FA\u73B0\u5F02\u5E38\u540E\u8FDB\u884C Fail Open \u5904\u7406\uFF0C\u8DF3\u8FC7\u63D2\u4EF6\u7684\u6267\u884C\u903B\u8F91\uFF0C\u5C06\u5BF9\u4E1A\u52A1\u7684\u5F71\u54CD\u964D\u81F3\u6700\u4F4E\u3002
<a name="Jy8LI"></a>
## \u5F00\u6E90\u793E\u533A
\u7279\u522B\u611F\u8C22 Istio/Envoy \u793E\u533A\u7684\u524D\u7F6E\u5DE5\u4F5C\uFF0C\u8BA9 Higress \u53EF\u4EE5\u5B9E\u73B0\u5BF9 Ingress \u8D44\u6E90\u542F\u7528 WasmPlugin \uFF0C\u589E\u5F3A\u4E86 Ingress Controller \u7684\u81EA\u5B9A\u4E49\u6269\u5C55\u80FD\u529B\u3002<br />\u7279\u522B\u611F\u8C22 Tetrate \u793E\u533A\u5B9E\u73B0\u7684 proxy-wasm-go-sdk\uFF0CHigress \u5728\u8FD9\u4E2A\u57FA\u7840\u4E0A\u5C01\u88C5\u4E86 wasm-go sdk\uFF0C\u964D\u4F4E\u4E86\u5F00\u53D1\u63D2\u4EF6\u7684\u4E0A\u624B\u95E8\u69DB\u3002<br />Higress \u5BF9 Istio/Envoy \u7684 Wasm \u80FD\u529B\u505A\u4E86\u4E00\u4E9B Bugfix \u7684\u5DE5\u4F5C\uFF0C\u76EE\u524D\u5DF2\u7ECF\u90FD\u5408\u5E76\u8FDB\u4E86\u4E0A\u6E38\u793E\u533A\u3002\u540E\u7EED\u7684\u4E00\u4E9B Feature \u80FD\u529B\uFF0C\u4E5F\u4F1A\u6301\u7EED\u53CD\u54FA\u4E0A\u6E38\u793E\u533A\u3002<br />\u540C\u65F6\u6B22\u8FCE\u5927\u5BB6\u4E00\u8D77\u4E3A Higress \u7684\u63D2\u4EF6\u4EE5\u53CA\u5176\u4ED6\u793E\u533A\u751F\u6001\u6DFB\u7816\u52A0\u74E6\uFF0C\u4E3A Higress \u8D21\u732E\u8BF7\u53C2\u8003\u6587\u6863\uFF1A<br />https://higress.io/zh-cn/docs/developers/guide_dev.html<br />\u5982\u6709\u4EA7\u54C1\u7591\u95EE\uFF0C\u53EF\u4EE5\u626B\u7801\u7ACB\u5373\u52A0\u5165\u7FA4\u804A\uFF1A<br />Higress\u793E\u533A\u4EA4\u6D413\u7FA4<br />![](https://intranetproxy.alipay.com/skylark/lark/0/2024/webp/299576/1723449123354-874e2ef4-789a-426e-8d3d-b2a12525f08b.webp#clientId=ubaf1ae1d-09cd-4&from=paste&id=ub225813a&originHeight=512&originWidth=522&originalType=url&ratio=1.7999999523162842&rotation=0&showTitle=false&status=done&style=none&taskId=u1f7c8c03-9174-4af6-b290-f870d42c6e1&title=)

`,i={title:"Higress \u5B9E\u6218\uFF1A30 \u884C\u4EE3\u7801\u5199\u4E00\u4E2A Wasm Go\u63D2\u4EF6",description:"Higress \u5B9E\u6218\uFF1A30 \u884C\u4EE3\u7801\u5199\u4E00\u4E2A Wasm Go\u63D2\u4EF6",keywords:["Higress"],date:"2023-01-16",category:"article"},t={type:"content",filePath:"/home/runner/work/higress-group.github.io/higress-group.github.io/src/content/blog/Higress-gvr7dx_awbbpb_fi4t7317cvughlzh.mdx",rawData:void 0};export{t as _internal,o as body,s as collection,i as data,e as id,a as slug};
