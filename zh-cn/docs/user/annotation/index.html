<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-user/annotation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Ingress Annotation 配置说明 | Higress</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://higress.io/zh-cn/img/higress_logo_small.png"><meta data-rh="true" name="twitter:image" content="https://higress.io/zh-cn/img/higress_logo_small.png"><meta data-rh="true" property="og:url" content="https://higress.io/zh-cn/docs/user/annotation"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="baidu-site-verification" content="codeva-T2MeTQHYnM"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ingress Annotation 配置说明 | Higress"><meta data-rh="true" name="description" content="Higress Ingress Annotation 配置说明。"><meta data-rh="true" property="og:description" content="Higress Ingress Annotation 配置说明。"><meta data-rh="true" name="keywords" content="Ingress"><link data-rh="true" rel="icon" href="/zh-cn/img/higress_logo_small.png"><link data-rh="true" rel="canonical" href="https://higress.io/zh-cn/docs/user/annotation"><link data-rh="true" rel="alternate" href="https://higress.io/en-us/docs/user/annotation" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://higress.io/zh-cn/docs/user/annotation" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://higress.io/docs/user/annotation" hreflang="default"><link data-rh="true" rel="alternate" href="https://higress.io/docs/user/annotation" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-cn/blog/rss.xml" title="Higress RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-cn/blog/atom.xml" title="Higress Atom Feed">






<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR" async></script><link rel="stylesheet" href="/zh-cn/assets/css/styles.69857bcd.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.eafa2191.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.52b6581f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="//img.alicdn.com/imgextra/i1/O1CN01I7WjVs1K33EQjInid_!!6000000001107-2-tps-960-290.png" alt="Higress logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="//img.alicdn.com/imgextra/i1/O1CN01I7WjVs1K33EQjInid_!!6000000001107-2-tps-960-290.png" alt="Higress logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-cn/">首页</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/docs/overview/what-is-higress">文档</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Higress 企业版</a><ul class="dropdown__menu"><li><a href="https://www.aliyun.com/product/aliware/mse?spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">企业版说明</a></li><li><a href="https://free.aliyun.com/?searchKey=云原生网关&amp;spm=higress-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="dropdown__link">免费试用</a></li></ul></div><a href="https://survey.aliyun.com/apps/zhiliao/SmDQwdihe" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">案例征集</a><a class="navbar__item navbar__link" href="/zh-cn/docs/developers/developers_dev">开发者</a><a class="navbar__item navbar__link" href="/zh-cn/blog">博客</a><a class="navbar__item navbar__link" href="/zh-cn/community">社区</a><a href="https://github.com/alibaba/higress/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">下载</a><a href="http://demo.higress.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">控制台样例</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中</a><ul class="dropdown__menu"><li><a href="/en-us/docs/user/annotation" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">En</a></li><li><a href="/zh-cn/docs/user/annotation" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">概述</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/overview/what-is-higress">Higress是什么</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/overview/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/overview/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/overview/terminology">术语表</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">用户指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/quickstart">快速开始</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/zh-cn/docs/user/configmap">参考手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/configmap">全局配置说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-cn/docs/user/annotation">Ingress Annotation 配置说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/annotation-use-case">通过Ingress Annotation实现高阶流量治理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/configurations">运维参数配置说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/mcp-bridge">Mcp Bridge 配置说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/dubbo-http2rpc">HTTP转Dubbo 配置说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/user/wasm-image-spec">Wasm 插件镜像规范</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-cn/docs/plugins/ai/ai-proxy">插件使用文档</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-cn/docs/user/wasm-go">最佳实践示例</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">运维指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-cn/docs/ops/hgctl">安装部署</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-cn/docs/ops/how-tos/grpc-upstream">操作指南</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/ops/upgrade">版本升级</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/ops/log">日志说明</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">开发者指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/dev/code">源码阅读指引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/dev/architecture">组件编译说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/dev/CustomResourceDefinition">Higress自定义CRD开发指引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/dev/e2e-debug">教程：如何在本地进行higress调试和端到端测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/dev/console-dev">教程：如何在本地开发和调试 Higress 控制台</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">用户指南</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">参考手册</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ingress Annotation 配置说明</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Ingress Annotaion 配置说明</h1><p>标准的K8s Ingress资源只能处理简单场景下的HTTP(S)流量路由，无法处理流量切分，超时重试，Header控制和跨域等问题。因此，不同的Ingress Controller利用自定义的Ingress Annotation增强Ingress能力。常见的Nginx Ingress Controller引入了100多个Annotation对Ingress在流量治理和安全防护上进行了扩展实现。目前，Higress已经全面兼容了大部分Nginx Ingress Annotation，方便用户从Nginx Ingress无缝迁移至Higress，本文主要介绍Higress关于Ingress Annotation的配置说明。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ingress-annotation">Ingress Annotation<a href="#ingress-annotation" class="hash-link" aria-label="Ingress Annotation的直接链接" title="Ingress Annotation的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特殊说明">特殊说明<a href="#特殊说明" class="hash-link" aria-label="特殊说明的直接链接" title="特殊说明的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="annotation-key-前缀">Annotation Key 前缀<a href="#annotation-key-前缀" class="hash-link" aria-label="Annotation Key 前缀的直接链接" title="Annotation Key 前缀的直接链接">​</a></h4><p>以下出现的Nginx Ingress Annotation都已被Higress支持，您可以根据使用习惯继续使用Nginx Ingress的Annotation前缀<code>nginx.ingress.kubernetes.io</code>，或者使用Higress Ingress的Annotation前缀<code>higress.io</code>，两者是等价的。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="作用域说明">作用域说明<a href="#作用域说明" class="hash-link" aria-label="作用域说明的直接链接" title="作用域说明的直接链接">​</a></h4><ul><li>Ingress：作用域为Ingress的Annotation的作用范围仅限当前Ingress上定义的路由规则。</li><li>域名：作用域为域名的Annotation，其作用范围为所有Ingress上出现的相同Host。</li><li>服务：作用域为服务的Annotation，其作用范围为所有Ingress上出现的相同Service。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="流量治理">流量治理<a href="#流量治理" class="hash-link" aria-label="流量治理的直接链接" title="流量治理的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="灰度发布">灰度发布<a href="#灰度发布" class="hash-link" aria-label="灰度发布的直接链接" title="灰度发布的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/canary</td><td>Ingress</td><td>兼容</td><td>开启或关闭灰度发布</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-by-header</td><td>Ingress</td><td>兼容</td><td>基于Request Header Key 流量切分</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-by-header-value</td><td>Ingress</td><td>兼容</td><td>基于Request Header Value 流量切分，Value为精确匹配</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-by-header-pattern</td><td>Ingress</td><td>兼容</td><td>基于Request Header Value 流量切分，Value为正则匹配</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-by-cookie</td><td>Ingress</td><td>兼容</td><td>基于Request Cookie Key 流量切分</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-weight</td><td>Ingress</td><td>兼容</td><td>基于权重 流量切分</td></tr><tr><td>nginx.ingress.kubernetes.io/canary-weight-total</td><td>Ingress</td><td>兼容</td><td>权重总和</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fallback容灾">Fallback（容灾）<a href="#fallback容灾" class="hash-link" aria-label="Fallback（容灾）的直接链接" title="Fallback（容灾）的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/default-backend</td><td>Ingress</td><td>兼容</td><td>容灾服务。当Ingress定义的服务没有可用节点时，请求会自动转发该容灾服务。</td></tr><tr><td>nginx.ingress.kubernetes.io/custom-http-errors</td><td>Ingress</td><td>兼容</td><td>该注解和<code>default-backend</code>一起工作。当后端服务返回指定HTTP响应码，原始请求会被再次转发至容灾服务。<br> &gt; 注意：转发至容灾服务时，请求的Path会被重写为/，该行为与ingress-nginx保持一致</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="重写">重写<a href="#重写" class="hash-link" aria-label="重写的直接链接" title="重写的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/rewrite-target</td><td>Ingress</td><td>兼容</td><td>将Ingress定义的原path重写为指定目标，支持Group Capture.</td></tr><tr><td>nginx.ingress.kubernetes.io/upstream-vhost</td><td>Ingress</td><td>兼容</td><td>匹配Ingress定义的路由的请求在转发给后端服务时，修改头部host值为指定值。</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="重定向">重定向<a href="#重定向" class="hash-link" aria-label="重定向的直接链接" title="重定向的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/ssl-redirect</td><td>Ingress</td><td>兼容</td><td>HTTP 重定向为HTTPS</td></tr><tr><td>nginx.ingress.kubernetes.io/force-ssl-redirect</td><td>Ingress</td><td>兼容</td><td>HTTP 重定向为HTTPS</td></tr><tr><td>nginx.ingress.kubernetes.io/permanent-redirect</td><td>Ingress</td><td>兼容</td><td>永久重定向</td></tr><tr><td>nginx.ingress.kubernetes.io/permanent-redirect-code</td><td>Ingress</td><td>兼容</td><td>永久重定向状态码</td></tr><tr><td>nginx.ingress.kubernetes.io/temporal-redirect</td><td>Ingress</td><td>兼容</td><td>临时重定向</td></tr><tr><td>nginx.ingress.kubernetes.io/app-root</td><td>Ingress</td><td>兼容</td><td>修改应用根路径，对于访问/的请求将会被重定向为设置的新路径</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="跨域">跨域<a href="#跨域" class="hash-link" aria-label="跨域的直接链接" title="跨域的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/enable-cors</td><td>Ingress</td><td>兼容</td><td>开启或关闭跨域</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-allow-origin</td><td>Ingress</td><td>兼容</td><td>允许的第三方站点</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-allow-methods</td><td>Ingress</td><td>兼容</td><td>允许的请求方法，如GET、POST、PUT等</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-allow-headers</td><td>Ingress</td><td>兼容</td><td>允许的请求Header</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-expose-headers</td><td>Ingress</td><td>兼容</td><td>允许的暴露给浏览器的响应Header</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-allow-credentials</td><td>Ingress</td><td>兼容</td><td>是否允许携带凭证信息</td></tr><tr><td>nginx.ingress.kubernetes.io/cors-max-age</td><td>Ingress</td><td>兼容</td><td>预检结果的最大缓存时间</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="超时">超时<a href="#超时" class="hash-link" aria-label="超时的直接链接" title="超时的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>higress.io/timeout</td><td>Ingress</td><td>Higress 扩展</td><td>请求的超时时间，单位为秒。默认未配置超时时间。超时设置作用在应用层，非传输层TCP。</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="单机限流">单机限流<a href="#单机限流" class="hash-link" aria-label="单机限流的直接链接" title="单机限流的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>higress.io/route-limit-rpm</td><td>Ingress</td><td>Higress 扩展</td><td>该Ingress定义的路由在每个网关实例上每分钟最大请求次数。瞬时最大请求次数为该值乘以limit-burst-multiplier。</td></tr><tr><td>higress.io/route-limit-rps</td><td>Ingress</td><td>Higress 扩展</td><td>该Ingress定义的路由在每个网关实例上每秒最大请求次数。瞬时最大请求次数为该值乘以limit-burst-multiplier。</td></tr><tr><td>higress.io/route-limit-burst-multiplier</td><td>Ingress</td><td>Higress 扩展</td><td>瞬时最大请求次数的因子，默认为5。</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="重试">重试<a href="#重试" class="hash-link" aria-label="重试的直接链接" title="重试的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/proxy-next-upstream-tries</td><td>Ingress</td><td>兼容</td><td>请求的最大重试次数。默认3次。</td></tr><tr><td>nginx.ingress.kubernetes.io/proxy-next-upstream-timeout</td><td>Ingress</td><td>兼容</td><td>请求重试的超时时间，单位秒。默认未配置超时时间。</td></tr><tr><td>nginx.ingress.kubernetes.io/proxy-next-upstream</td><td>Ingress</td><td>兼容</td><td>请求重试条件，参考<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream</a></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="后端服务使用的协议">后端服务使用的协议<a href="#后端服务使用的协议" class="hash-link" aria-label="后端服务使用的协议的直接链接" title="后端服务使用的协议的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/backend-protocol</td><td>服务</td><td>部分兼容。不支持AJP和FCGI</td><td>指定后端服务使用的协议，默认为HTTP，支持HTTP、HTTP2、HTTPS、GRPC和GRPCS</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="负载均衡">负载均衡<a href="#负载均衡" class="hash-link" aria-label="负载均衡的直接链接" title="负载均衡的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/load-balance</td><td>服务</td><td>部分兼容。不支持<code>ewma</code>算法</td><td>后端服务的普通负载均衡算法。默认为round_robin。 <br>合法值如下：<br>- round_robin：基于轮询的负载均衡。<br>- least_conn：基于最小请求数的负载均衡。<br>- random：基于随机的负载均衡。<br> &gt; 注意：Higress不支持ewma算法，若配置为ewma算法，会回退到round_robin算法。</td></tr><tr><td>nginx.ingress.kubernetes.io/upstream-hash-by</td><td>服务</td><td>部分兼容。暂不支持Nginx变量、常量的组合使用方式</td><td>基于一致Hash的负载均衡算法，Higress支持以下几种形式：<br>1. Higress支持配置部分nginx变量：<br>- $request_uri：请求的Path（包括路径参数）作为Hash Key <br>- $host：请求的Host作为Hash Key<br>- $remote_addr：请求的客户端IP作为Hash Key。<br>2. 基于请求header的一致性Hash。您只需配置为$http_headerName。<br>3. 基于请求路径参数的一致性Hash。您只需配置为$arg_varName</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cookie亲和性">Cookie亲和性<a href="#cookie亲和性" class="hash-link" aria-label="Cookie亲和性的直接链接" title="Cookie亲和性的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/affinity</td><td>服务</td><td>兼容</td><td>亲和性种类，目前只支持cookie，默认为cookie。</td></tr><tr><td>nginx.ingress.kubernetes.io/affinity-mode</td><td>服务</td><td>部分兼容。暂不支持<code>persistent</code>模式</td><td>亲和性模式，云原生网关目前只支持balanced模式，默认为balanced模式。</td></tr><tr><td>nginx.ingress.kubernetes.io/session-cookie-name</td><td>服务</td><td>兼容</td><td>配置指定Cookie的值作为Hash Key</td></tr><tr><td>nginx.ingress.kubernetes.io/session-cookie-path</td><td>服务</td><td>兼容</td><td>当指定Cookie不存在，生成的Cookie的Path值，默认为/</td></tr><tr><td>nginx.ingress.kubernetes.io/session-cookie-max-age</td><td>服务</td><td>兼容</td><td>当指定Cookie不存在，生成的Cookie的过期时间，单位为秒，默认为Session会话级别。</td></tr><tr><td>nginx.ingress.kubernetes.io/session-cookie-expires</td><td>服务</td><td>兼容</td><td>当指定Cookie不存在，生成的Cookie的过期时间，单位为秒，默认为Session会话级别。</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ip访问控制">IP访问控制<a href="#ip访问控制" class="hash-link" aria-label="IP访问控制的直接链接" title="IP访问控制的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/<a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#whitelist-source-range" target="_blank" rel="noopener noreferrer">whitelist-source-range</a></td><td>Ingress</td><td>兼容</td><td>指定路由上的IP白名单，支持IP地址或CIDR地址块，以逗号分隔。</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安全防护">安全防护<a href="#安全防护" class="hash-link" aria-label="安全防护的直接链接" title="安全防护的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端与网关之前的通信加密">客户端与网关之前的通信加密<a href="#客户端与网关之前的通信加密" class="hash-link" aria-label="客户端与网关之前的通信加密的直接链接" title="客户端与网关之前的通信加密的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/ssl-cipher</td><td>域名</td><td>兼容</td><td>指定tls的加密套件，可以指定多个，英文逗号分隔，仅当tls握手时采用TLSv1.0-1.2生效。<br>默认加密套件如下：<br>- ECDHE-ECDSA-AES128-GCM-SHA256<br>- ECDHE-RSA-AES128-GCM-SHA256<br>- ECDHE-ECDSA-AES128-SHA<br>- ECDHE-RSA-AES128-SHA<br>- AES128-GCM-SHA256<br>- AES128-SHA<br>- ECDHE-ECDSA-AES256-GCM-SHA384<br>- ECDHE-RSA-AES256-GCM-SHA384<br>- ECDHE-ECDSA-AES256-SHA<br>- ECDHE-RSA-AES256-SHA<br>- AES256-GCM-SHA384<br>- AES256-SHA</td></tr><tr><td>nginx.ingress.kubernetes.io/auth-tls-secret</td><td>域名</td><td>部分兼容。secret名字格式必须是：(该域名证书所在的secret的名字)-cacert</td><td>网关使用的CA证书，用于验证MTLS握手期间，客户端提供的证书。该注解主要应用于网关需要验证客户端身份的场景。</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="网关与后端服务之间通信加密">网关与后端服务之间通信加密<a href="#网关与后端服务之间通信加密" class="hash-link" aria-label="网关与后端服务之间通信加密的直接链接" title="网关与后端服务之间通信加密的直接链接">​</a></h4><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/proxy-ssl-secret</td><td>服务</td><td>兼容</td><td>网关使用的客户端证书，用于后端服务对网关进行身份认证</td></tr><tr><td>nginx.ingress.kubernetes.io/proxy-ssl-name</td><td>服务</td><td>兼容</td><td>TLS握手期间使用的SNI</td></tr><tr><td>nginx.ingress.kubernetes.io/proxy-ssl-server-name</td><td>服务</td><td>兼容</td><td>开启或关闭TLS握手期间使用SNI</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安全认证">安全认证<a href="#安全认证" class="hash-link" aria-label="安全认证的直接链接" title="安全认证的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="basic">Basic<a href="#basic" class="hash-link" aria-label="Basic的直接链接" title="Basic的直接链接">​</a></h5><table><thead><tr><th>注解</th><th>作用域</th><th>支持度</th><th>说明</th></tr></thead><tbody><tr><td>nginx.ingress.kubernetes.io/auth-type</td><td>Ingress</td><td>部分兼容。暂只支持Basic。</td><td>认证类型</td></tr><tr><td>nginx.ingress.kubernetes.io/auth-secret</td><td>Ingress</td><td>兼容</td><td>Secret名字，格式支持<!-- -->&lt;<!-- -->namespace<!-- -->&gt;<!-- -->/<!-- -->&lt;<!-- -->name<!-- -->&gt;<!-- -->，包含被授予能够访问该Ingress上定义的路由的访问权限的用户名和密码。</td></tr><tr><td>nginx.ingress.kubernetes.io/auth-secret-type</td><td>Ingress</td><td>兼容</td><td>Secret内容格式。<br>- auth-file：data的key为auth；value为用户名和密码，多帐号回车分隔<br>- auth-map：data的key为用户名；value为密码</td></tr><tr><td>nginx.ingress.kubernetes.io/auth-realm</td><td>Ingress</td><td>兼容</td><td>保护域。相同的保护域共享用户名和密码。</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="备注">备注<a href="#备注" class="hash-link" aria-label="备注的直接链接" title="备注的直接链接">​</a></h2><p>关于以上提到的Nginx Ingress Annotation的更多信息，请参阅官方文档（<a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#annotations" target="_blank" rel="noopener noreferrer">https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#annotations</a>）。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/higress-group/higress-group.github.io/blob/main/i18n/zh-cn/docusaurus-plugin-content-docs/current/user/annotation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-cn/docs/user/configmap"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">全局配置说明</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/docs/user/annotation-use-case"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">通过Ingress Annotation实现高阶流量治理</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ingress-annotation" class="table-of-contents__link toc-highlight">Ingress Annotation</a><ul><li><a href="#特殊说明" class="table-of-contents__link toc-highlight">特殊说明</a></li><li><a href="#流量治理" class="table-of-contents__link toc-highlight">流量治理</a></li><li><a href="#安全防护" class="table-of-contents__link toc-highlight">安全防护</a></li></ul></li><li><a href="#备注" class="table-of-contents__link toc-highlight">备注</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">愿景</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/">为用户提供一站式云原生网关解决方案.</a></li></ul></div><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/docs/overview/what-is-higress">Higress是什么?</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-cn/docs/user/quickstart">快速开始</a></li><li class="footer__item"><a href="https://github.com/higress-group/higress-group.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">报告文档问题<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/higress-group/higress-group.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">在GitHub上编辑此文档<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">资源</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/blog">博客</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-cn/community">社区</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="//img.alicdn.com/imgextra/i2/O1CN01oNTGgE1lfW7oEPIzP_!!6000000004846-2-tps-960-290.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="120" height="36"><img src="//img.alicdn.com/imgextra/i2/O1CN01oNTGgE1lfW7oEPIzP_!!6000000004846-2-tps-960-290.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="120" height="36"></div><div class="footer__copyright">Copyright © 2023 Higress<br>浙公网安备 33011002016922号 浙ICP备12022327号-1119</div></div></div></footer></div>
<script src="/zh-cn/assets/js/runtime~main.eafa2191.js"></script>
<script src="/zh-cn/assets/js/main.52b6581f.js"></script>
</body>
</html>